# 河北省省赛外榜推送系统

本系统是2024年CCPC河北省省赛是使用的外榜推送系统
省赛使用的是pta系统，因此本系统只能在使用pta进行比赛时使用
外榜就是board.xcpcio.com
作者：laobuzhang

## 使用说明
其中有多个py文件，作用如下：
- board_frost.py
    - 比赛结束后，想要解封榜单，运行一下该文件即可
- board_functions.py
    - 主要函数文件，存放要使用到的函数
- board_main.py
    - main文件，比赛开始后，运行此文件即可开始推送外榜
- booard_trans.py
    - 生成队伍信息的文件，会根据team.xlsx和pta中的数据，创建为队伍数据文件，保存在./data/team.json文件中
    - 在运行main文件前，请先运行此文件生成队伍信息
    - 运行此文件前，请先完成team.xlsx文件，完成pta中队伍账号的创建，完成pta比赛中加入用户组

## 配置文件
在config文件夹中，有两个配置文件，需要在运行前修改
- cfg.json
    - problemId: pta的比赛的id，可以直接进入比赛，在连接中找到比赛id
    - cookie: pta中拥有该比赛管理权限的账号的cookie，获取方式为登陆该账号，在f12中找到cookie并复制下来
    - token: 向board.xcpcio.com中推送数据时需要使用的token，请联系board的管理人员获取
- config.json
    - 这里边主要配置一些比赛相关的信息
    - 从上到下依次为
    - 比赛名称，比赛开始时间戳，比赛结束时间戳，封榜时长，罚时，题目数量，题目编号，队伍类型（推荐不要改变），组织类型（推荐不要改变），显示状态（推荐不要改变），奖牌数（根据自己情况修改），题目颜色和对应气球颜色（根据自己需求修改），图标（应该是ICPC和CCPC两种）,其它选项（推荐不修改）

## 运行环境
我使用的时vscode，安装了coderunner插件，直接右键 run code就能运行程序
同时安装了python3.10
使用到了一些第三方包，需要自己pip install（有些包的名字和安装时使用的名字不一样，所以尽量查一查）

## team.xlsx
该文件为队伍表
- 队伍名前加星号表示是打星队伍
- 序号一列代码中没有用到，根据自己需求编写就行（但是要有）
- 校内队伍序号一列代码中中没有用到，根据自己需求编写就行（但是要有）
- 赛场和座位号根据自己情况编写：
    - 我们的情况是，使用了6个教室作为赛场（6061就是其中的一个教室号）
    - 每个教室都有一个对应的字母编号，例如A对应6061,B对应6064...
    - 每个教室都只有两位数个队伍，所以我们的座位号格式为A01,B15...
- PTA学号：
    - 格式为：比赛缩写比赛年份-座位号
    - 我们是河北省省赛（HBCPC），2024年（2024），座位号上文说过，所以最终是（HBCPC2024-A01）
    - 建议和我们一样的形式命名学号，因为pta中学号是唯一的（比如你今年用A01，明年还想用A01，明年会把今年的覆盖掉，我们这样子编写学号不会重复）
    - 当然也可以使用别的形式，但是要保证表格中的和PTA中的格式一致（表格中有的pta中也要有）
- PTA姓名就是在pta中创建队伍是给的名字，


## 程序原理
主要原理是调用pta的接口，获取到pta中提交列表的数据
然后把pta中得到的提交数据的格式转换为board需要的数据格式
最后把转换后的数据推送给board
队伍信息的获取也是一样的原理

需要在比赛时不断地推送，现在的逻辑是，每60秒（可以在board_main.py中spider函数最后修改sleep的时间从而修改这个时间）从pta获取数据（增量数据），然后推送给board
为了保证数据的正确性，每爬取12次增量数据，就重新从第一条数据开始爬取一次，并覆盖前边的数据（因为调用pta的接口的时候会出现可能正在判题或者少爬取了几条之类的问题）